<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html>
<head>
<title>Reference unpacker</title>
<script>
function unpack(lookup, data) {
	var key, time, uncompressed, lookupSize = 0;

	// Calc lookup size
	for (key in lookup)
		lookupSize += key.length + lookup[key].length;

	time = new Date().getTime();

	function replace(value) {
		return value.replace(/[A-Z]+/g, function(key) {
			return replace(lookup[key]);
		});
	};

	// Unpack lookup
	for (key in lookup)
		lookup[key] = replace(lookup[key]);

	// Unpack data
	uncompressed = replace(data);
	time = new Date().getTime() - time;

	// Log results
	log('Unpacking took: ' + time + ' ms' + ' , ratio: ' + Math.round(100 - ((lookupSize + data.length) / uncompressed.length) * 100) + '%');
	log('Data: ' + uncompressed + '\n');
}

function log(str) {
	document.getElementById('output').innerHTML += (str + "\n").replace(/\n/g, '<br />');
}
</script>
</head>
<body>
<pre id="output">
</pre>
<script src="dtds/xhtml1-strict.dtd.compressed.min.js"></script>
<script src="dtds/xhtml1-transitional.dtd.compressed.min.js"></script>
</body>
</html>
